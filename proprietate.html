<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAVINVEST ‚Äì Proprietate</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root{--green-deep:#1a3a2a;--green-mid:#2d6a4f;--green-bright:#40916c;--green-light:#74c69d;--green-pale:#b7e4c7;--green-mist:#d8f3dc;--white:#fafff8;--off-white:#f1f9f3;--text-dark:#0d2318;--gold:#c9a84c;}
  *{margin:0;padding:0;box-sizing:border-box;}
  a{color:inherit;text-decoration:none;}
  html{scroll-behavior:smooth;}
  body{font-family:'Jost',sans-serif;background:var(--white);color:var(--text-dark);}
  nav{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:16px 60px;background:rgba(250,255,248,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--green-pale);}
  .nav-logo{display:flex;align-items:center;gap:12px;}
  .nav-logo-text{display:flex;flex-direction:column;}
  .nav-logo-text span:first-child{font-family:'Playfair Display',serif;font-size:20px;font-weight:900;letter-spacing:2px;color:var(--green-deep);}
  .nav-logo-text span:last-child{font-size:9px;font-weight:500;letter-spacing:4px;color:var(--green-bright);text-transform:uppercase;}
  .btn-back{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--green-mid);padding:8px 20px;border:1.5px solid var(--green-pale);border-radius:2px;transition:all 0.2s;}
  .btn-back:hover{border-color:var(--green-mid);background:var(--green-mist);}
  .prop-hero{display:grid;grid-template-columns:1fr 380px;min-height:70vh;}
  .gallery{position:relative;background:var(--green-deep);overflow:hidden;}
  .gallery-main{width:100%;height:100%;min-height:500px;object-fit:cover;display:block;cursor:zoom-in;}
  .gallery-placeholder{width:100%;min-height:500px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--green-deep),var(--green-mid));font-size:80px;opacity:0.2;}
  .gallery-thumbs{position:absolute;bottom:16px;left:16px;right:16px;display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;}
  .gallery-thumbs::-webkit-scrollbar{height:3px;}
  .gallery-thumbs::-webkit-scrollbar-thumb{background:var(--green-light);border-radius:2px;}
  .thumb{width:72px;height:52px;flex-shrink:0;cursor:pointer;border-radius:3px;overflow:hidden;border:2px solid transparent;opacity:0.7;transition:all 0.2s;}
  .thumb.active{border-color:white;opacity:1;}
  .thumb:hover{opacity:1;}
  .thumb img{width:100%;height:100%;object-fit:cover;}
  .gallery-counter{position:absolute;top:16px;right:16px;background:rgba(0,0,0,0.5);color:white;backdrop-filter:blur(4px);padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;}
  .gallery-nav{position:absolute;top:50%;transform:translateY(-50%);display:flex;justify-content:space-between;width:100%;padding:0 12px;pointer-events:none;}
  .gallery-btn{pointer-events:all;background:rgba(255,255,255,0.15);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.3);color:white;width:44px;height:44px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
  .gallery-btn:hover{background:rgba(255,255,255,0.3);}
  .prop-sidebar{padding:40px 36px;background:var(--white);border-left:1px solid var(--green-mist);overflow-y:auto;display:flex;flex-direction:column;gap:24px;}
  .prop-badge{display:inline-block;padding:5px 14px;border-radius:2px;font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;background:var(--gold);color:var(--text-dark);width:fit-content;}
  .prop-type-label{font-size:10px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:var(--green-bright);}
  .prop-title{font-family:'Playfair Display',serif;font-size:clamp(22px,2.5vw,30px);font-weight:900;color:var(--green-deep);line-height:1.2;}
  .prop-location{display:flex;align-items:center;gap:8px;font-size:14px;color:#5a7a65;}
  .prop-price{font-family:'Playfair Display',serif;font-size:36px;font-weight:900;color:var(--green-deep);}
  .prop-price-note{font-size:11px;color:#7a9a82;margin-top:2px;}
  .features-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:20px 0;border-top:1px solid var(--green-mist);border-bottom:1px solid var(--green-mist);}
  .feature-item{display:flex;flex-direction:column;gap:3px;}
  .feature-label{font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--green-bright);}
  .feature-value{font-size:15px;font-weight:600;color:var(--green-deep);}
  .contact-section{display:flex;flex-direction:column;gap:10px;}
  .btn-whatsapp{display:flex;align-items:center;justify-content:center;gap:10px;background:#25d366;color:white;padding:14px;border-radius:3px;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;transition:background 0.2s;}
  .btn-whatsapp:hover{background:#1ebe5d;}
  .btn-phone{display:flex;align-items:center;justify-content:center;gap:10px;background:var(--green-deep);color:white;padding:14px;border-radius:3px;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;transition:background 0.2s;}
  .btn-phone:hover{background:var(--green-mid);}
  .btn-email{display:flex;align-items:center;justify-content:center;gap:10px;background:transparent;color:var(--green-mid);padding:13px;border-radius:3px;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;transition:all 0.2s;border:1.5px solid var(--green-mid);}
  .btn-email:hover{background:var(--green-mist);}
  .prop-content{display:grid;grid-template-columns:1fr 380px;border-top:1px solid var(--green-mist);}
  .prop-main{padding:60px;border-right:1px solid var(--green-mist);}
  .section-label{font-size:10px;font-weight:700;letter-spacing:5px;text-transform:uppercase;color:var(--green-bright);margin-bottom:16px;display:flex;align-items:center;gap:10px;}
  .section-label::before{content:'';display:block;width:24px;height:1px;background:var(--green-bright);}
  .prop-desc{font-size:16px;line-height:1.9;color:#3a5a48;font-weight:300;margin-bottom:48px;}
  .video-wrap{position:relative;padding-bottom:56.25%;height:0;border-radius:4px;overflow:hidden;margin-bottom:48px;box-shadow:0 8px 32px rgba(26,58,42,0.12);}
  .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%;border:none;}
  .map-wrap{border-radius:4px;overflow:hidden;box-shadow:0 8px 32px rgba(26,58,42,0.12);height:380px;}
  .map-wrap iframe{width:100%;height:100%;border:none;}
  .prop-aside{padding:60px 40px;background:var(--off-white);}
  .info-card{background:white;border-radius:4px;padding:24px;border:1px solid var(--green-pale);margin-bottom:20px;}
  .info-card h3{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--green-deep);margin-bottom:16px;}
  .info-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--green-mist);font-size:13px;}
  .info-row:last-child{border-bottom:none;}
  .info-row span:first-child{color:#7a9a82;font-weight:500;}
  .info-row span:last-child{color:var(--green-deep);font-weight:600;}
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:999;display:none;align-items:center;justify-content:center;}
  .lightbox.open{display:flex;}
  .lightbox img{max-width:90vw;max-height:90vh;object-fit:contain;border-radius:3px;}
  .lightbox-close{position:absolute;top:20px;right:28px;color:white;font-size:32px;cursor:pointer;background:none;border:none;line-height:1;}
  .lightbox-nav{position:absolute;top:50%;transform:translateY(-50%);width:100%;display:flex;justify-content:space-between;padding:0 20px;pointer-events:none;}
  .lightbox-btn{pointer-events:all;background:rgba(255,255,255,0.12);border:none;color:white;width:52px;height:52px;border-radius:50%;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;}
  .lightbox-btn:hover{background:rgba(255,255,255,0.25);}
  .not-found{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center;padding:40px;}
  .not-found .icon{font-size:64px;margin-bottom:20px;opacity:0.3;}
  .not-found h2{font-family:'Playfair Display',serif;font-size:28px;color:var(--green-deep);margin-bottom:10px;}
  .loading-page{display:flex;align-items:center;justify-content:center;min-height:60vh;font-size:18px;color:#7a9a82;}
  @media(max-width:900px){
    nav{padding:14px 20px;}
    .prop-hero{grid-template-columns:1fr;}
    .prop-sidebar{border-left:none;border-top:1px solid var(--green-mist);}
    .prop-content{grid-template-columns:1fr;}
    .prop-main{padding:40px 20px;border-right:none;border-bottom:1px solid var(--green-mist);}
    .prop-aside{padding:40px 20px;}
    .gallery-main{min-height:280px;}
    .gallery-placeholder{min-height:280px;}
  }
</style>
</head>
<body>
<nav>
  <a class="nav-logo" href="index.html">
    <svg width="38" height="34" viewBox="0 0 64 58" fill="none">
      <polygon points="14,54 0,54 7,33" fill="#b7e4c7"/>
      <polygon points="50,54 64,54 57,33" fill="#b7e4c7"/>
      <polygon points="32,4 8,54 56,54" fill="#1a3a2a"/>
      <polygon points="32,4 56,54 32,54" fill="#2d6a4f"/>
      <rect x="0" y="54" width="64" height="2.5" fill="#40916c"/>
      <polygon points="32,4 25,21 39,21" fill="#ffffff"/>
    </svg>
    <div class="nav-logo-text">
      <span>SAVINVEST</span>
      <span>Imobiliare</span>
    </div>
  </a>
  <a href="index.html" class="btn-back">‚Üê √énapoi la proprietƒÉ»õi</a>
</nav>

<div id="pageContent"><div class="loading-page">‚è≥ Se √ÆncarcƒÉ...</div></div>

<div class="lightbox" id="lightbox">
  <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
  <img id="lightboxImg" src="" alt="">
  <div class="lightbox-nav">
    <button class="lightbox-btn" onclick="lightboxNav(-1)">‚Äπ</button>
    <button class="lightbox-btn" onclick="lightboxNav(1)">‚Ä∫</button>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://onjwsqzkrhvknitohqyl.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9uandzcXprcmh2a25pdG9ocXlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NzkwMjYsImV4cCI6MjA4NzE1NTAyNn0.fj_t4quODGN3MQds3TVcshi5cLpYssy77qgJ3KbwCdQ';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const params = new URLSearchParams(window.location.search);
const id = params.get('id');
let prop = null;
let currentPhoto = 0;

async function loadProp() {
  if (!id) { showNotFound(); return; }
  const { data, error } = await sb.from('proprietati').select('*').eq('id', id).single();
  if (error || !data) { showNotFound(); return; }
  prop = data;
  document.title = 'SAVINVEST ‚Äì ' + prop.title;
  renderPage(prop);
}

function showNotFound() {
  document.getElementById('pageContent').innerHTML = `
    <div class="not-found">
      <div class="icon">üèîÔ∏è</div>
      <h2>Proprietatea nu a fost gƒÉsitƒÉ</h2>
      <p>Este posibil sƒÉ fi fost »ôtearsƒÉ sau link-ul sƒÉ fie incorect.</p>
    </div>`;
}

function renderPage(p) {
  const photos = p.photos && p.photos.length > 0 ? p.photos : [];
  const phone = p.phone || '+40720123456';
  const waLink = 'https://wa.me/' + phone.replace(/[^0-9]/g,'') + '?text=' + encodeURIComponent('BunƒÉ ziua! Sunt interesat de proprietatea: ' + p.title);

  const galleryHTML = photos.length > 0 ? `
    <img class="gallery-main" id="galleryMain" src="${photos[0]}" alt="${p.title}" onclick="openLightbox(0)">
    ${photos.length > 1 ? `
      <div class="gallery-nav">
        <button class="gallery-btn" onclick="changePhoto(-1)">‚Äπ</button>
        <button class="gallery-btn" onclick="changePhoto(1)">‚Ä∫</button>
      </div>
      <div class="gallery-counter" id="galleryCounter">1 / ${photos.length}</div>
      <div class="gallery-thumbs">
        ${photos.map((src,i) => `<div class="thumb ${i===0?'active':''}" id="thumb${i}" onclick="setPhoto(${i})"><img src="${src}" alt=""></div>`).join('')}
      </div>` : ''}
  ` : '<div class="gallery-placeholder">üè°</div>';

  const videoHTML = p.video ? `<div class="section-label">Video</div><div class="video-wrap"><iframe src="${getEmbedUrl(p.video)}" allowfullscreen></iframe></div>` : '';
  const mapHTML = p.map ? `<div class="section-label">Loca»õie pe HartƒÉ</div><div class="map-wrap"><iframe src="https://maps.google.com/maps?q=${encodeURIComponent(p.map)}&output=embed" allowfullscreen loading="lazy"></iframe></div>` : '';

  document.getElementById('pageContent').innerHTML = `
    <div class="prop-hero">
      <div class="gallery">${galleryHTML}</div>
      <div class="prop-sidebar">
        ${p.badge ? `<span class="prop-badge">${p.badge}</span>` : ''}
        <div class="prop-type-label">${p.type || ''}</div>
        <h1 class="prop-title">${p.title}</h1>
        <div class="prop-location">üìç ${p.location || ''}</div>
        <div>
          <div class="prop-price">${p.price ? p.price + ' ‚Ç¨' : 'Pre»õ la cerere'}</div>
          <div class="prop-price-note">Pre»õ negociabil ¬∑ TVA inclus</div>
        </div>
        <div class="features-grid">
          ${p.rooms ? `<div class="feature-item"><span class="feature-label">Camere</span><span class="feature-value">üõè ${p.rooms}</span></div>` : ''}
          ${p.baths ? `<div class="feature-item"><span class="feature-label">BƒÉi</span><span class="feature-value">üöø ${p.baths}</span></div>` : ''}
          ${p.area  ? `<div class="feature-item"><span class="feature-label">Suprafa»õƒÉ</span><span class="feature-value">üìê ${p.area} m¬≤</span></div>` : ''}
          ${p.land  ? `<div class="feature-item"><span class="feature-label">Teren</span><span class="feature-value">üå≥ ${p.land}</span></div>` : ''}
        </div>
        <div class="contact-section">
          <a href="${waLink}" target="_blank" class="btn-whatsapp">üí¨ WhatsApp</a>
          <a href="tel:${phone}" class="btn-phone">üìû ${phone}</a>
          <a href="mailto:office@savinvest.ro?subject=Interesat: ${encodeURIComponent(p.title)}" class="btn-email">‚úâÔ∏è Trimite Email</a>
        </div>
      </div>
    </div>
    <div class="prop-content">
      <div class="prop-main">
        ${p.desc ? `<div class="section-label">Descriere</div><p class="prop-desc">${p.desc.replace(/\n/g,'<br>')}</p>` : ''}
        ${videoHTML}${mapHTML}
      </div>
      <div class="prop-aside">
        <div class="info-card">
          <h3>Detalii Proprietate</h3>
          ${p.type     ? `<div class="info-row"><span>Tip</span><span>${p.type}</span></div>` : ''}
          ${p.location ? `<div class="info-row"><span>Loca»õie</span><span>${p.location}</span></div>` : ''}
          ${p.area     ? `<div class="info-row"><span>Suprafa»õƒÉ</span><span>${p.area} m¬≤</span></div>` : ''}
          ${p.land     ? `<div class="info-row"><span>Teren</span><span>${p.land}</span></div>` : ''}
          ${p.rooms    ? `<div class="info-row"><span>Camere</span><span>${p.rooms}</span></div>` : ''}
          ${p.baths    ? `<div class="info-row"><span>BƒÉi</span><span>${p.baths}</span></div>` : ''}
          ${p.price    ? `<div class="info-row"><span>Pre»õ</span><span>${p.price} ‚Ç¨</span></div>` : ''}
        </div>
        <div class="info-card">
          <h3>Contact Agent</h3>
          <div class="info-row"><span>Agen»õie</span><span>SAVINVEST</span></div>
          <div class="info-row"><span>Telefon</span><span>${phone}</span></div>
          <div class="info-row"><span>Email</span><span>office@savinvest.ro</span></div>
          <div class="info-row"><span>Program</span><span>Lun‚ÄìVin 09‚Äì18</span></div>
        </div>
      </div>
    </div>`;
}

function setPhoto(i) {
  currentPhoto = i;
  document.getElementById('galleryMain').src = prop.photos[i];
  document.querySelectorAll('.thumb').forEach((t,idx) => t.classList.toggle('active', idx===i));
  const c = document.getElementById('galleryCounter');
  if(c) c.textContent = (i+1) + ' / ' + prop.photos.length;
}
function changePhoto(dir) { setPhoto((currentPhoto+dir+prop.photos.length)%prop.photos.length); }
function openLightbox(i) { currentPhoto=i; document.getElementById('lightboxImg').src=prop.photos[i]; document.getElementById('lightbox').classList.add('open'); document.body.style.overflow='hidden'; }
function closeLightbox() { document.getElementById('lightbox').classList.remove('open'); document.body.style.overflow=''; }
function lightboxNav(dir) { currentPhoto=(currentPhoto+dir+prop.photos.length)%prop.photos.length; document.getElementById('lightboxImg').src=prop.photos[currentPhoto]; }
document.getElementById('lightbox').addEventListener('click', function(e){ if(e.target===this) closeLightbox(); });
document.addEventListener('keydown', e => { if(!document.getElementById('lightbox').classList.contains('open')) return; if(e.key==='ArrowLeft') lightboxNav(-1); if(e.key==='ArrowRight') lightboxNav(1); if(e.key==='Escape') closeLightbox(); });
function getEmbedUrl(url) {
  const yt = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
  if(yt) return 'https://www.youtube.com/embed/'+yt[1];
  const vm = url.match(/vimeo\.com\/(\d+)/);
  if(vm) return 'https://player.vimeo.com/video/'+vm[1];
  return url;
}

loadProp();
</script>
</body>
</html>
